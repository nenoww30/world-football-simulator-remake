<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Football Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --cor-fundo: #121212;
            --cor-superficie: #1e1e1e;
            --cor-borda: #333;
            --cor-texto-principal: #e0e0e0;
            --cor-texto-secundario: #a0a0a0;
            --cor-texto-titulo: #ffffff;
            --cor-botao-primario: #0d6efd;
            --cor-botao-primario-hover: #3a86ff;
            --cor-botao-secundario: #495057;
            --cor-botao-secundario-hover: #6c757d;
            --cor-amarelo: #ffc107;
            --cor-vermelho: #dc3545;
            --cor-sucesso: #198754;
            --font-titulo: 'Poppins', sans-serif;
            --font-corpo: 'Roboto', sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            font-family: var(--font-corpo);
            background-color: var(--cor-fundo);
            color: var(--cor-texto-principal);
            text-align: center; margin: 0; padding: 0;
            -webkit-font-smoothing: antialiased;
        }
        header { background-color: var(--cor-fundo); color: var(--cor-texto-titulo); padding: 1.5rem 0; }
        h1, h2, h3, h4 { margin: 0; color: var(--cor-texto-titulo); font-family: var(--font-titulo); font-weight: 600; }
        h1 { font-size: 2.5em; text-shadow: 0px 2px 10px rgba(0,0,0,0.5); }
        h2 { margin-bottom: 2rem; font-size: 1.8em; }
        h3 { margin-bottom: 1.5rem; font-size: 1.4em; }
        h4 { font-size: 1.1em; }
        main { padding: 1rem; }
        .tela-container {
            background-color: var(--cor-superficie); max-width: 800px;
            margin: 1rem auto; padding: 2rem;
            border-radius: 12px; border: 1px solid var(--cor-borda);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .botoes-acao { margin-bottom: 1.5rem; }
        .botoes-acao button, .form-botoes button { margin: 5px; }
        button {
            color: white; border: none; padding: 12px 28px;
            font-family: var(--font-corpo); font-size: 16px; font-weight: 500;
            cursor: pointer; border-radius: 8px;
            transition: all 0.3s ease;
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-primario { background-color: var(--cor-botao-primario); }
        .btn-primario:hover { background-color: var(--cor-botao-primario-hover); }
        .btn-secundario { background-color: var(--cor-botao-secundario); }
        .btn-secundario:hover { background-color: var(--cor-botao-secundario-hover); }
        button:disabled { background-color: #3a3a3a; color: #888; cursor: not-allowed; transform: none; box-shadow: none; }
        .escondido { display: none !important; }
        .filtro-container { margin-bottom: 1.5rem; text-align: left; }
        .filtro-container label { margin-right: 10px; font-weight: 500; }
        .filtro-container select { padding: 10px; background-color: #2a2a2a; color: var(--cor-texto-principal); border: 1px solid var(--cor-borda); border-radius: 8px; width: 100%; font-family: var(--font-corpo); }
        .amistoso-filtros { display: flex; justify-content: space-between; gap: 1rem; margin-bottom: 1rem; }
        .amistoso-filtros .filtro-container { flex: 1; }
        .selecao-times { display: flex; justify-content: space-around; align-items: center; margin-bottom: 1.5rem; }
        .time-box select { width: 100%; max-width: 250px; padding: 10px; background-color: #2a2a2a; color: var(--cor-texto-principal); border: 1px solid var(--cor-borda); border-radius: 8px; font-size: 16px; }
        .time-box label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .taticas-container { display: flex; gap: 2rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--cor-borda); }
        .tatica-box { flex: 1; text-align: center; }
        .tatica-box label { font-weight: 500; font-family: var(--font-titulo); font-size: 1.1em; }
        .tatica-box span { color: var(--cor-amarelo); font-weight: bold; display: block; margin-top: 5px; height: 20px; }
        #lista-times-editor { text-align: left; }
        .item-time-editor { display: flex; align-items: center; padding: 1rem; background-color: #2a2a2a; border-radius: 8px; margin-bottom: 0.75rem; transition: background-color 0.3s ease; }
        .item-time-editor:hover { background-color: #343a40; }
        .item-time-info { flex-grow: 1; display: flex; align-items: center; gap: 15px; }
        .escudo-lista { width: 30px; height: 30px; object-fit: contain; font-size: 1.8em; line-height: 1; text-align: center; }
        .item-time-info .nome-time { font-weight: 500; }
        .item-time-info .forca-time { color: var(--cor-texto-secundario); font-style: italic; font-size: 0.9em; }
        .item-time-acoes button { padding: 6px 12px; font-size: 14px; margin-left: 8px; }
        .btn-apagar { background-color: var(--cor-vermelho); }
        .btn-apagar:hover { background-color: #e5383b; }
        .form-edicao-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; text-align: left; }
        .form-coluna { display: flex; flex-direction: column; gap: 1.5rem; }
        .form-grupo { display: flex; flex-direction: column; }
        .form-grupo label { margin-bottom: 8px; font-weight: 500; color: var(--cor-texto-secundario); }
        .form-grupo input { padding: 12px; background-color: #2a2a2a; border: 1px solid var(--cor-borda); color: var(--cor-texto-principal); border-radius: 8px; font-size: 1em; font-family: var(--font-corpo); transition: border-color 0.3s, box-shadow 0.3s; }
        .form-grupo input:focus { border-color: var(--cor-botao-primario); box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25); outline: none; }
        .slider-container { display: grid; grid-template-columns: 60px 1fr 50px; align-items: center; gap: 15px; }
        .slider-container label { margin-bottom: 0; font-weight: 500; }
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 8px; background: #3a3a3a; border-radius: 5px; outline: none; transition: opacity .2s; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--cor-botao-primario); border-radius: 50%; cursor: pointer; border: 2px solid var(--cor-superficie); }
        input[type="range"]::-moz-range-thumb { width: 20px; height: 20px; background: var(--cor-botao-primario); border-radius: 50%; cursor: pointer; border: 2px solid var(--cor-superficie); }
        .slider-container span { font-weight: 500; color: var(--cor-amarelo); text-align: right; }
        .escudo-selecionado-container { display: flex; align-items: center; gap: 15px; }
        #escudo-display { width: 64px; height: 64px; display: flex; justify-content: center; align-items: center; background-color: #000; border-radius: 8px; }
        #escudo-display img { max-width: 100%; max-height: 100%; }
        #escudo-display span { font-size: 3em; }
        .escudo-botoes { display: flex; flex-direction: column; gap: 5px; }
        .escudo-botoes button { padding: 8px 12px; font-size: 14px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-conteudo { background-color: var(--cor-superficie); padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%; border: 1px solid var(--cor-borda); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        #emoji-galeria { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 10px; max-height: 250px; overflow-y: auto; margin-top: 1rem; background-color: #000; padding: 10px; border-radius: 8px; }
        .emoji-item { font-size: 2em; cursor: pointer; transition: transform 0.2s; }
        .emoji-item:hover { transform: scale(1.2); }
        .editor-elenco-container { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--cor-borda); }
        .elenco-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem; text-align: left; }
        .posicao-coluna h4 { margin-top: 0; margin-bottom: 1rem; color: var(--cor-amarelo); border-bottom: 1px solid #444; padding-bottom: 0.5rem; }
        .jogador-input-container { margin-bottom: 0.5rem; }
        .jogador-input { width: 100%; box-sizing: border-box; padding: 8px; background-color: #111; border: 1px solid #444; color: var(--cor-texto-principal); border-radius: 8px; }
        .form-botoes { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--cor-borda); display: flex; justify-content: flex-end; align-items: center; flex-wrap: wrap; }
        .placar-container { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background-color: #2c2c2c; border-radius: 8px; margin-bottom: 1rem; }
        .time-placar { display: flex; align-items: center; gap: 15px; font-size: 1.2em; font-weight: 500;}
        .placar-escudo { width: 40px; height: 40px; object-fit: contain; font-size: 2.5em; line-height: 1; text-align: center; }
        .placar-central { font-size: 2.2em; font-family: var(--font-titulo); font-weight: 700; color: var(--cor-texto-titulo); text-align: center; }
        .minuto-jogo { font-size: 0.5em; font-weight: 400; color: var(--cor-amarelo); display: block; }
        .partida-corpo { display: flex; justify-content: space-between; gap: 1rem; }
        .log-coluna { width: 35%; height: 350px; background-color: #000; border: 1px solid var(--cor-borda); border-radius: 8px; padding: 1rem; overflow-y: auto; font-size: 0.9em; }
        .stats-coluna { width: 30%; display: flex; flex-direction: column; justify-content: center; gap: 0.8rem; text-align: center; }
        .stat-item { display: flex; justify-content: space-between; align-items: center; background-color: #2c2c2c; padding: 8px 12px; border-radius: 8px; }
        .stat-item span:nth-child(1), .stat-item span:nth-child(3) { font-weight: 500; font-size: 1.2em; }
        .stat-item span:nth-child(2) { font-size: 0.9em; color: var(--cor-texto-secundario); }
        .log-evento { margin-bottom: 12px; transition: transform 0.2s ease-out; }
        .log-gol { background-color: var(--cor-sucesso); color: #ffffff; font-weight: 500; padding: 5px; border-radius: 4px; transform: scale(1.02); }
        .log-gol .jogador { color: #ffffff !important; }
        .controle-velocidade { display: flex; align-items: center; justify-content: center; background-color: var(--cor-botao-primario); border-radius: 20px; padding: 4px; margin: 0 auto; width: fit-content; }
        .btn-vel { background-color: transparent; border: none; color: white; font-weight: bold; font-size: 1.2em; cursor: pointer; width: 30px; height: 30px; line-height: 30px; padding: 0; border-radius: 50%; transition: background-color 0.2s; }
        .btn-vel:hover { background-color: rgba(255, 255, 255, 0.2); }
        .btn-vel:disabled { background-color: transparent; color: #777; cursor: not-allowed; }
        .btn-vel:disabled:hover { background-color: transparent; }
        #display-velocidade { margin: 0 15px; font-weight: 500; font-size: 1.1em; color: white; user-select: none; }
        .notas-container { display: flex; gap: 1rem; margin-top: 1rem; }
        .notas-coluna { flex: 1; background-color: #000; padding: 1rem; border-radius: 8px; border: 1px solid var(--cor-borda); }
        .nota-valor { font-weight: 500; font-size: 1.1em; padding: 4px 8px; border-radius: 4px; color: white; }
        .nota-otima { background-color: #007bff; } .nota-boa { background-color: var(--cor-sucesso); }
        .nota-media { background-color: #6c757d; } .nota-ruim { background-color: #f57c00; }
        .nota-pessima { background-color: var(--cor-vermelho); }
        .nota-jogador { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid #2a2a2a; }
        .nota-jogador:last-child { border-bottom: none; }
        .jogador-nome-stats { flex-grow: 1; text-align: left; }
        .jogador-stats { font-size: 0.9em; }
        .jogador-stats span { margin-right: 10px; }
        @media (max-width: 850px) {
            .form-edicao-grid, .amistoso-filtros, .partida-corpo, .notas-container, .taticas-container { flex-direction: column; }
            .selecao-times {flex-direction: column; gap: 1rem;}
        }
    </style>
</head>
<body>
    <header><h1>World Football Simulator</h1></header>
    <main>
        <div id="tela-inicial" class="tela-container">
            <h2>Menu Principal</h2>
            <button id="btn-amistoso" class="btn-primario">Amistoso</button>
            <button id="btn-editor" class="btn-secundario">Editor de Times</button>
        </div>

        <div id="tela-amistoso" class="tela-container escondido">
            <h2>Amistoso</h2>
            <div class="amistoso-filtros">
                <div class="filtro-container">
                    <label for="filtro-categoria-casa">Categoria Casa</label>
                    <select id="filtro-categoria-casa"></select>
                </div>
                <div class="filtro-container">
                    <label for="filtro-categoria-visitante">Categoria Visitante</label>
                    <select id="filtro-categoria-visitante"></select>
                </div>
            </div>
            <div class="selecao-times">
                <div class="time-box"><label for="select-casa">Time da Casa</label><select id="select-casa"></select></div>
                <h3>VS</h3>
                <div class="time-box"><label for="select-visitante">Time Visitante</label><select id="select-visitante"></select></div>
            </div>
            <div class="botoes-acao">
                <button id="btn-simular-partida" class="btn-primario">Simular Partida</button>
                <button id="btn-voltar-amistoso" class="btn-secundario">Voltar ao Menu</button>
                <button id="btn-ver-notas" class="btn-primario escondido">Ver Notas</button>
            </div>
            <div id="area-simulacao" class="escondido">
                <div class="taticas-container">
                    <div class="tatica-box">
                        <label for="tatica-casa">Mentalidade Casa</label>
                        <input type="range" id="tatica-casa" min="1" max="5" value="3">
                        <span id="display-tatica-casa">Equilibrado</span>
                    </div>
                    <div class="tatica-box">
                        <label for="tatica-visitante">Mentalidade Visitante</label>
                        <input type="range" id="tatica-visitante" min="1" max="5" value="3">
                        <span id="display-tatica-visitante">Equilibrado</span>
                    </div>
                </div>
                <div id="area-resultado-amistoso">
                    <div class="placar-container">
                        <div class="time-placar" id="time-placar-casa"></div>
                        <div id="placar-central" class="placar-central">0 - 0</div>
                        <div class="time-placar" id="time-placar-visitante"></div>
                    </div>
                    <div class="partida-corpo">
                        <div id="log-casa" class="log-coluna"></div>
                        <div class="stats-coluna">
                            <div class="controle-velocidade">
                                <button id="btn-vel-menos" class="btn-vel">-</button>
                                <span id="display-velocidade">2x</span>
                                <button id="btn-vel-mais" class="btn-vel">+</button>
                            </div>
                            <div class="stat-item"><span id="stat-chutes-casa">0</span><span>Chutes</span><span id="stat-chutes-visitante">0</span></div>
                            <div class="stat-item"><span id="stat-chutes-gol-casa">0</span><span>Chutes a Gol</span><span id="stat-chutes-gol-visitante">0</span></div>
                            <div class="stat-item"><span id="stat-posse-casa">50</span><span>Posse %</span><span id="stat-posse-visitante">50</span></div>
                            <div class="stat-item"><span id="stat-amarelos-casa">0</span><span>Cartões A.</span><span id="stat-amarelos-visitante">0</span></div>
                            <div class="stat-item"><span id="stat-vermelhos-casa">0</span><span>Cartões V.</span><span id="stat-vermelhos-visitante">0</span></div>
                        </div>
                        <div id="log-visitante" class="log-coluna"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="tela-notas" class="tela-container escondido">
            <h2>Notas dos Jogadores</h2>
            <div class="notas-container">
                <div id="notas-casa" class="notas-coluna"></div>
                <div id="notas-visitante" class="notas-coluna"></div>
            </div>
            <button id="btn-voltar-das-notas" class="btn-secundario" style="margin-top: 1.5rem;">Voltar</button>
        </div>

        <div id="tela-editor" class="tela-container escondido">
            <div id="editor-lista-container">
                <h2>Editor de Times</h2>
                <div class="botoes-acao">
                    <button id="btn-criar-time" class="btn-primario">Criar Novo Time</button>
                    <button id="btn-exportar-times" class="btn-secundario">Exportar Times</button>
                    <button id="btn-importar-times" class="btn-secundario">Importar Times</button>
                    <button id="btn-voltar-do-editor" class="btn-secundario">Voltar ao Menu</button>
                </div>
                <div class="filtro-container">
                    <label for="filtro-categoria-editor">Filtrar por Categoria:</label>
                    <select id="filtro-categoria-editor"></select>
                </div>
                <div id="lista-times-editor"></div>
            </div>
            <div id="editor-form-container" class="escondido">
                <h2 id="form-titulo">Criar Novo Time</h2>
                <form id="form-time">
                    <div id="form-time-principal">
                        <div class="form-edicao-grid">
                            <div class="form-coluna">
                                <div class="form-grupo"><label for="time-nome">Nome do Time</label><input type="text" id="time-nome" required></div>
                                <div class="form-grupo"><label for="time-categoria">Categoria</label><input type="text" id="time-categoria" placeholder="Ex: Seleções"></div>
                                <div class="form-grupo">
                                    <label>Escudo</label>
                                    <div class="escudo-selecionado-container">
                                        <div id="escudo-display"><span>⭐</span></div>
                                        <div class="escudo-botoes">
                                            <button type="button" id="btn-mudar-emoji" class="btn-secundario">Mudar Emoji</button>
                                            <button type="button" id="btn-colar-url" class="btn-secundario">Colar URL</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-coluna">
                                <div class="form-grupo">
                                    <label>Atributos</label>
                                    <div class="slider-container"><label for="time-ataque">Ataque</label><input type="range" id="time-ataque" min="1" max="100" value="50"><span id="valor-ataque">50</span></div>
                                    <div class="slider-container"><label for="time-defesa">Defesa</label><input type="range" id="time-defesa" min="1" max="100" value="50"><span id="valor-defesa">50</span></div>
                                    <div class="slider-container"><label for="time-passe">Passe</label><input type="range" id="time-passe" min="1" max="100" value="50"><span id="valor-passe">50</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="editor-elenco-container" class="editor-elenco-container escondido">
                        <h3>Editar Elenco</h3>
                        <div id="elenco-grid" class="elenco-grid"></div>
                    </div>
                    <div class="form-botoes">
                        <button type="button" id="btn-gerenciar-elenco" class="btn-secundario">Gerenciar Elenco</button>
                        <button type="button" id="btn-cancelar-edicao" class="btn-secundario">Cancelar</button>
                        <button type="submit" class="btn-primario">Salvar Time</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="modal-emojis" class="modal-overlay escondido">
            <div class="modal-conteudo">
                <h3>Escolha um Emoji</h3>
                <div id="emoji-galeria"></div>
                <button type="button" id="btn-fechar-modal" class="btn-secundario" style="margin-top: 1rem;">Fechar</button>
            </div>
        </div>
        
        <input type="file" id="importar-arquivo" class="escondido" accept=".json,.txt">
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        
        let timesDB = [];
        const listaEmojis = ["⭐", "⚽", "🏆", "🌎", "🔥", "⚡", "🚀", "👑", "🛡️", "⚔️", "❤️", "💀", "👻", "👽", "🤖", "🦁", "🐯", "🐺", "🦅", "🐲", "🐙", "🦈", "🕷️", "🦂", "🐍", "🇧🇷", "🇦🇷", "🇫🇷", "🇩🇪", "🏴󠁧󠁢󠁥󠁮󠁧󠁿", "🇵🇹", "🇮🇹", "🇪🇸", "🇳🇱", "🇧🇪"];
        let simulacaoIntervalo = null;
        let tickPartida = null;
        let partidaJogadores = { casa: [], visitante: [] };
        let timeEmEdicaoId = null;
        let escudoAtual = '⭐';

        const todasAsTelas = document.querySelectorAll('main > .tela-container');
        const telaInicial = document.getElementById('tela-inicial');
        const telaAmistoso = document.getElementById('tela-amistoso');
        const telaEditor = document.getElementById('tela-editor');
        const telaNotas = document.getElementById('tela-notas');
        
        const editorListaContainer = document.getElementById('editor-lista-container');
        const editorFormContainer = document.getElementById('editor-form-container');
        const formTime = document.getElementById('form-time');
        const formTitulo = document.getElementById('form-titulo');
        const filtroCategoriaEditor = document.getElementById('filtro-categoria-editor');
        const btnEditor = document.getElementById('btn-editor');
        const btnVoltarDoEditor = document.getElementById('btn-voltar-do-editor');
        const btnCriarTime = document.getElementById('btn-criar-time');
        const btnCancelarEdicao = document.getElementById('btn-cancelar-edicao');
        const btnExportar = document.getElementById('btn-exportar-times');
        const btnImportar = document.getElementById('btn-importar-times');
        const importarArquivoInput = document.getElementById('importar-arquivo');
        const inputAtaque = document.getElementById('time-ataque');
        const valorAtaque = document.getElementById('valor-ataque');
        const inputDefesa = document.getElementById('time-defesa');
        const valorDefesa = document.getElementById('valor-defesa');
        const inputPasse = document.getElementById('time-passe');
        const valorPasse = document.getElementById('valor-passe');
        const modalEmojis = document.getElementById('modal-emojis');
        const btnMudarEmoji = document.getElementById('btn-mudar-emoji');
        const btnColarURL = document.getElementById('btn-colar-url');
        const btnFecharModal = document.getElementById('btn-fechar-modal');
        const escudoDisplay = document.getElementById('escudo-display');
        const emojiGaleria = document.getElementById('emoji-galeria');
        const editorElencoContainer = document.getElementById('editor-elenco-container');
        const elencoGrid = document.getElementById('elenco-grid');
        const btnGerenciarElenco = document.getElementById('btn-gerenciar-elenco');

        const btnAmistoso = document.getElementById('btn-amistoso');
        const btnVoltarAmistoso = document.getElementById('btn-voltar-amistoso');
        const btnSimularPartida = document.getElementById('btn-simular-partida');
        const btnVerNotas = document.getElementById('btn-ver-notas');
        const btnVoltarDasNotas = document.getElementById('btn-voltar-das-notas');
        const filtroCategoriaCasa = document.getElementById('filtro-categoria-casa');
        const filtroCategoriaVisitante = document.getElementById('filtro-categoria-visitante');
        const selectCasa = document.getElementById('select-casa');
        const selectVisitante = document.getElementById('select-visitante');
        const areaSimulacao = document.getElementById('area-simulacao');
        const btnVelMenos = document.getElementById('btn-vel-menos');
        const btnVelMais = document.getElementById('btn-vel-mais');
        const displayVelocidade = document.getElementById('display-velocidade');
        const taticaSliderCasa = document.getElementById('tatica-casa');
        const taticaSliderVisitante = document.getElementById('tatica-visitante');
        const displayTaticaCasa = document.getElementById('display-tatica-casa');
        const displayTaticaVisitante = document.getElementById('display-tatica-visitante');
        
        const mentalidades = {
            '1': { texto: 'Ultra Defensivo', modAtk: 0.6, modDef: 1.4 },
            '2': { texto: 'Defensivo', modAtk: 0.8, modDef: 1.2 },
            '3': { texto: 'Equilibrado', modAtk: 1.0, modDef: 1.0 },
            '4': { texto: 'Ofensivo', modAtk: 1.2, modDef: 0.8 },
            '5': { texto: 'Ultra Ofensivo', modAtk: 1.4, modDef: 0.6 }
        };

        function salvarTimesNoLocalStorage() { localStorage.setItem('wfs_timesDB', JSON.stringify(timesDB)); }
        function carregarTimes() {
            const timesSalvos = localStorage.getItem('wfs_timesDB');
            let db = timesSalvos ? JSON.parse(timesSalvos) : [];
            db.forEach(time => {
                if (time.hasOwnProperty('forca')) { time.ataque = time.defesa = time.passe = time.forca; delete time.forca; }
                if (!time.categoria) time.categoria = 'Sem Categoria';
                if (!time.escudo) time.escudo = '⭐';
                if (!time.jogadores || time.jogadores.length === 0) time.jogadores = criarElencoGenerico();
            });
            timesDB = db;
            if (timesDB.length === 0) {
                timesDB = [
                    { id: 1, nome: "Brasil", ataque: 92, defesa: 88, passe: 90, escudo: "🇧🇷", categoria: "Seleções", jogadores: criarElencoGenerico() },
                    { id: 2, nome: "Argentina", ataque: 91, defesa: 87, passe: 89, escudo: "🇦🇷", categoria: "Seleções", jogadores: criarElencoGenerico() }
                ];
            }
            salvarTimesNoLocalStorage();
        }
        
        function mostrarTela(tela) { document.querySelectorAll('main > .tela-container').forEach(t => t.classList.add('escondido')); tela.classList.remove('escondido'); }
        btnAmistoso.addEventListener('click', () => { mostrarTela(telaAmistoso); inicializarTelaAmistoso(); });
        btnEditor.addEventListener('click', () => { mostrarTela(telaEditor); mostrarContainerEditor('lista'); popularFiltroCategorias(filtroCategoriaEditor); popularListaEditor(); });
        btnVoltarDoEditor.addEventListener('click', () => mostrarTela(telaInicial));
        btnVoltarAmistoso.addEventListener('click', () => mostrarTela(telaInicial));
        btnVoltarDasNotas.addEventListener('click', () => { mostrarTela(telaAmistoso); areaSimulacao.classList.remove('escondido'); });
        btnCancelarEdicao.addEventListener('click', () => mostrarContainerEditor('lista'));

        function mostrarContainerEditor(container) {
            editorListaContainer.classList.toggle('escondido', container === 'form');
            editorFormContainer.classList.toggle('escondido', container !== 'form');
        }
        function popularFiltroCategorias(filtroSelect) {
            const categorias = ['Todas as Categorias', ...new Set(timesDB.map(time => time.categoria).filter(Boolean))];
            filtroSelect.innerHTML = '';
            categorias.forEach(cat => {
                const valor = (cat === 'Todas as Categorias') ? 'ALL' : cat;
                filtroSelect.add(new Option(cat, valor));
            });
        }
        function ehURL(str) { try { return Boolean(new URL(str)); } catch(e){ return false; } }
        function popularListaEditor() {
            const listaDiv = document.getElementById('lista-times-editor');
            listaDiv.innerHTML = '';
            const categoriaSelecionada = filtroCategoriaEditor.value;
            const timesFiltrados = (categoriaSelecionada === 'ALL') ? timesDB : timesDB.filter(time => time.categoria === categoriaSelecionada);
            if (timesFiltrados.length === 0) { listaDiv.innerHTML = '<p>Nenhum time encontrado.</p>'; return; }
            timesFiltrados.forEach(time => {
                const forcaGeral = Math.round((time.ataque + time.defesa + time.passe) / 3);
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-time-editor';
                const escudoHTML = ehURL(time.escudo) ? `<img src="${time.escudo}" class="escudo-lista" alt="" onerror="this.parentElement.innerHTML = '⭐';">` : `<span class="escudo-lista">${time.escudo}</span>`;
                itemDiv.innerHTML = `<div class="item-time-info">${escudoHTML}<span class="nome-time">${time.nome}</span><span class="forca-time">Força: ${forcaGeral}</span></div><div class="item-time-acoes"><button class="btn-secundario btn-editar" data-id="${time.id}">Editar</button><button class="btn-apagar" data-id="${time.id}">Apagar</button></div>`;
                listaDiv.appendChild(itemDiv);
            });
            document.querySelectorAll('.btn-apagar').forEach(btn => btn.addEventListener('click', apagarTime));
            document.querySelectorAll('.btn-editar').forEach(btn => btn.addEventListener('click', editarTime));
        }
        function syncSliderValue(slider, display) { display.textContent = slider.value; }
        inputAtaque.addEventListener('input', () => syncSliderValue(inputAtaque, valorAtaque));
        inputDefesa.addEventListener('input', () => syncSliderValue(inputDefesa, valorDefesa));
        inputPasse.addEventListener('input', () => syncSliderValue(inputPasse, valorPasse));
        function popularGaleriaEmojis() { emojiGaleria.innerHTML = ''; listaEmojis.forEach(emoji => { const span = document.createElement('span'); span.className = 'emoji-item'; span.textContent = emoji; span.onclick = () => { escudoAtual = emoji; atualizarDisplayEscudo(); modalEmojis.classList.add('escondido'); }; emojiGaleria.appendChild(span); }); }
        btnMudarEmoji.addEventListener('click', () => modalEmojis.classList.remove('escondido'));
        btnFecharModal.addEventListener('click', () => modalEmojis.classList.add('escondido'));
        btnColarURL.addEventListener('click', () => { const url = prompt("Cole a URL do escudo:", escudoAtual); if (url && ehURL(url)) { escudoAtual = url; atualizarDisplayEscudo(); } else if (url) { alert("URL inválida."); } });
        function atualizarDisplayEscudo() { escudoDisplay.innerHTML = ehURL(escudoAtual) ? `<img src="${escudoAtual}" alt="Escudo">` : `<span>${escudoAtual}</span>`; }
        function apagarTime(e) { const timeId = parseInt(e.target.dataset.id); const time = timesDB.find(t => t.id === timeId); if (confirm(`Apagar "${time.nome}"?`)) { timesDB = timesDB.filter(t => t.id !== timeId); salvarTimesNoLocalStorage(); popularFiltroCategorias(filtroCategoriaEditor); popularListaEditor(); } }
        function editarTime(e) {
            timeEmEdicaoId = parseInt(e.target.dataset.id);
            const time = timesDB.find(t => t.id === timeEmEdicaoId);
            formTitulo.textContent = 'Editar Time';
            document.getElementById('time-nome').value = time.nome;
            escudoAtual = time.escudo;
            atualizarDisplayEscudo();
            document.getElementById('time-categoria').value = time.categoria || '';
            inputAtaque.value = time.ataque; syncSliderValue(inputAtaque, valorAtaque);
            inputDefesa.value = time.defesa; syncSliderValue(inputDefesa, valorDefesa);
            inputPasse.value = time.passe; syncSliderValue(inputPasse, valorPasse);
            popularEditorElenco(time);
            btnGerenciarElenco.textContent = "Gerenciar Elenco";
            btnGerenciarElenco.classList.remove('escondido');
            editorElencoContainer.classList.add('escondido');
            document.getElementById('form-time-principal').classList.remove('escondido');
            mostrarContainerEditor('form');
        }
        btnCriarTime.addEventListener('click', () => {
            timeEmEdicaoId = null;
            formTitulo.textContent = 'Criar Novo Time';
            formTime.reset();
            escudoAtual = '⭐';
            atualizarDisplayEscudo();
            inputAtaque.value = 50; syncSliderValue(inputAtaque, valorAtaque);
            inputDefesa.value = 50; syncSliderValue(inputDefesa, valorDefesa);
            inputPasse.value = 50; syncSliderValue(inputPasse, valorPasse);
            btnGerenciarElenco.classList.add('escondido');
            editorElencoContainer.classList.add('escondido');
            document.getElementById('form-time-principal').classList.remove('escondido');
            mostrarContainerEditor('form');
        });
        btnGerenciarElenco.addEventListener('click', () => { const escondido = editorElencoContainer.classList.toggle('escondido'); document.getElementById('form-time-principal').classList.toggle('escondido'); btnGerenciarElenco.textContent = escondido ? "Gerenciar Elenco" : "Ver Time"; });
        function salvarElenco() {
            if (timeEmEdicaoId === null) return;
            const time = timesDB.find(t => t.id === timeEmEdicaoId);
            if (!time) return;
            document.querySelectorAll('.jogador-input').forEach(input => { const index = parseInt(input.dataset.index); const novoNome = input.value.trim(); if (novoNome) time.jogadores[index].nome = novoNome; });
        }
        formTime.addEventListener('submit', (e) => {
            e.preventDefault();
            salvarElenco();
            const nome = document.getElementById('time-nome').value;
            const categoria = document.getElementById('time-categoria').value.trim() || 'Sem Categoria';
            const ataque = parseInt(inputAtaque.value);
            const defesa = parseInt(inputDefesa.value);
            const passe = parseInt(inputPasse.value);
            if (timeEmEdicaoId === null) { const novoId = timesDB.length > 0 ? Math.max(...timesDB.map(t => t.id)) + 1 : 1; timesDB.push({ id: novoId, nome, escudo: escudoAtual, categoria, ataque, defesa, passe, jogadores: criarElencoGenerico() }); } else { const timeIndex = timesDB.findIndex(t => t.id === timeEmEdicaoId); const timeOriginal = timesDB[timeIndex]; timesDB[timeIndex] = { ...timeOriginal, nome, escudo: escudoAtual, categoria, ataque, defesa, passe }; }
            salvarTimesNoLocalStorage();
            popularFiltroCategorias(filtroCategoriaEditor);
            popularListaEditor();
            mostrarContainerEditor('lista');
        });
        function criarElencoGenerico() {
            const elenco = [];
            for(let i=1; i<=3; i++) elenco.push({ nome: `Goleiro ${i}`, posicao: 'GOL' });
            for(let i=1; i<=7; i++) elenco.push({ nome: `Defensor ${i}`, posicao: 'DEF' });
            for(let i=1; i<=8; i++) elenco.push({ nome: `Meio-campista ${i}`, posicao: 'MEI' });
            for(let i=1; i<=5; i++) elenco.push({ nome: `Atacante ${i}`, posicao: 'ATA' });
            return elenco;
        }
        function popularEditorElenco(time) {
            elencoGrid.innerHTML = '';
            const posicoes = { 'GOL': [], 'DEF': [], 'MEI': [], 'ATA': [] };
            time.jogadores.forEach((jogador, index) => { if (posicoes[jogador.posicao]) posicoes[jogador.posicao].push({ ...jogador, index }); });
            for (const [pos, jogadores] of Object.entries(posicoes)) {
                const colunaDiv = document.createElement('div');
                colunaDiv.className = 'posicao-coluna';
                let titulo = pos;
                if(pos === 'GOL') titulo = 'Goleiros'; if(pos === 'DEF') titulo = 'Defensores'; if(pos === 'MEI') titulo = 'Meio-campistas'; if(pos === 'ATA') titulo = 'Atacantes';
                colunaDiv.innerHTML = `<h4>${titulo}</h4>`;
                jogadores.forEach(jogador => { colunaDiv.innerHTML += `<div class="jogador-input-container"><input type="text" class="jogador-input" value="${jogador.nome}" data-index="${jogador.index}"></div>`; });
                elencoGrid.appendChild(colunaDiv);
            }
        }
        filtroCategoriaEditor.addEventListener('change', popularListaEditor);
        function inicializarTelaAmistoso() { popularFiltroCategorias(filtroCategoriaCasa); popularFiltroCategorias(filtroCategoriaVisitante); popularSeletoresAmistoso(); areaSimulacao.classList.add('escondido'); btnVerNotas.classList.add('escondido'); }
        function popularSeletoresAmistoso() {
            const catCasa = filtroCategoriaCasa.value; const catVisitante = filtroCategoriaVisitante.value;
            const timesCasa = (catCasa === 'ALL' || !catCasa) ? timesDB : timesDB.filter(t => t.categoria === catCasa);
            const timesVisitante = (catVisitante === 'ALL' || !catVisitante) ? timesDB : timesDB.filter(t => t.categoria === catVisitante);
            selectCasa.innerHTML = ''; timesCasa.forEach(time => selectCasa.add(new Option(time.nome, time.id)));
            selectVisitante.innerHTML = ''; timesVisitante.forEach(time => selectVisitante.add(new Option(time.nome, time.id)));
            if (selectVisitante.options.length > 1 && selectCasa.value === selectVisitante.value) selectVisitante.selectedIndex = 1;
        }
        filtroCategoriaCasa.addEventListener('change', popularSeletoresAmistoso);
        filtroCategoriaVisitante.addEventListener('change', popularSeletoresAmistoso);
        const velocidades = [ { texto: '1x', valor: 250 }, { texto: '2x', valor: 125 }, { texto: '3x', valor: 75 }, { texto: '4x', valor: 50 }, { texto: '5x', valor: 30 } ];
        let velocidadeAtualIndex = 1;
        function atualizarDisplayVelocidade() { displayVelocidade.textContent = velocidades[velocidadeAtualIndex].texto; btnVelMenos.disabled = (velocidadeAtualIndex === 0); btnVelMais.disabled = (velocidadeAtualIndex === velocidades.length - 1); }
        function atualizarIntervaloSimulacao() { if (!simulacaoIntervalo || !tickPartida) return; clearInterval(simulacaoIntervalo); const novaVelocidade = velocidades[velocidadeAtualIndex].valor; simulacaoIntervalo = setInterval(tickPartida, novaVelocidade); }
        btnVelMais.addEventListener('click', () => { if (velocidadeAtualIndex < velocidades.length - 1) { velocidadeAtualIndex++; atualizarDisplayVelocidade(); atualizarIntervaloSimulacao(); } });
        btnVelMenos.addEventListener('click', () => { if (velocidadeAtualIndex > 0) { velocidadeAtualIndex--; atualizarDisplayVelocidade(); atualizarIntervaloSimulacao(); } });
        btnSimularPartida.addEventListener('click', () => { if (selectCasa.value && selectVisitante.value) simularPartida(); else alert("Selecione os times."); });
        
        function simularPartida() {
            if (simulacaoIntervalo) clearInterval(simulacaoIntervalo);
            const idCasa = selectCasa.value, idVisitante = selectVisitante.value;
            if (idCasa === idVisitante) { alert("Selecione times diferentes."); return; }
            const timeCasa = JSON.parse(JSON.stringify(timesDB.find(t => t.id == idCasa)));
            const timeVisitante = JSON.parse(JSON.stringify(timesDB.find(t => t.id == idVisitante)));
            partidaJogadores.casa = timeCasa.jogadores.map(j => ({...j, timeNome: timeCasa.nome, gols: 0, assistencias: 0, cartaoAmarelo: false, cartaoVermelho: false}));
            partidaJogadores.visitante = timeVisitante.jogadores.map(j => ({...j, timeNome: timeVisitante.nome, gols: 0, assistencias: 0, cartaoAmarelo: false, cartaoVermelho: false}));
            areaSimulacao.classList.remove('escondido'); btnVerNotas.classList.add('escondido');
            const timePlacarCasa = document.getElementById('time-placar-casa');
            const timePlacarVisitante = document.getElementById('time-placar-visitante');
            const placarCentralDiv = document.getElementById('placar-central');
            const logCasaDiv = document.getElementById('log-casa');
            const logVisitanteDiv = document.getElementById('log-visitante');
            logCasaDiv.innerHTML = ''; logVisitanteDiv.innerHTML = '';
            
            const escudoCasaHTML = ehURL(timeCasa.escudo) ? `<img src="${timeCasa.escudo}" class="placar-escudo" alt="">` : `<span class="placar-escudo">${timeCasa.escudo}</span>`;
            const escudoVisitanteHTML = ehURL(timeVisitante.escudo) ? `<img src="${timeVisitante.escudo}" class="placar-escudo" alt="">` : `<span class="placar-escudo">${timeVisitante.escudo}</span>`;
            timePlacarCasa.innerHTML = `${escudoCasaHTML} <span>${timeCasa.nome}</span>`;
            timePlacarVisitante.innerHTML = `<span>${timeVisitante.nome}</span> ${escudoVisitanteHTML}`;

            let minuto = 0;
            const stats = { casa: { gols: 0, chutes: 0, chutesNoGol: 0, amarelos: 0, vermelhos: 0, posse: 0 }, visitante: { gols: 0, chutes: 0, chutesNoGol: 0, amarelos: 0, vermelhos: 0, posse: 0 } };
            
            tickPartida = () => {
                minuto++;
                placarCentralDiv.innerHTML = `${stats.casa.gols} - ${stats.visitante.gols} <div class="minuto-jogo"><span>${minuto}</span>'</div>`;
                
                const mentalidadeCasa = mentalidades[taticaSliderCasa.value];
                const mentalidadeVisitante = mentalidades[taticaSliderVisitante.value];
                const passeTotal = (timeCasa.passe * mentalidadeCasa.modAtk) + (timeVisitante.passe * mentalidadeVisitante.modAtk);
                const posseCasaChance = (timeCasa.passe * mentalidadeCasa.modAtk) / passeTotal;
                
                const timeComPosse = Math.random() < posseCasaChance ? 'casa' : 'visitante';

                const equipe = timeComPosse === 'casa' ? { id: 'casa', time: timeCasa, stats: stats.casa, logDiv: logCasaDiv, adversario: timeVisitante, mentalidade: mentalidadeCasa } : { id: 'visitante', time: timeVisitante, stats: stats.visitante, logDiv: logVisitanteDiv, adversario: timeCasa, mentalidade: mentalidadeVisitante };
                const mentalidadeAdversaria = timeComPosse === 'casa' ? mentalidadeVisitante : mentalidadeCasa;
                
                equipe.stats.posse++;

                const ataqueEfetivo = equipe.time.ataque * equipe.mentalidade.modAtk;
                const chanceDeAtaque = ataqueEfetivo / 800;
                if (Math.random() < chanceDeAtaque) {
                    equipe.stats.chutes++;
                    const jogador = selecionarJogador(partidaJogadores[equipe.id]);
                    if (!jogador) return;

                    const defesaEfetivaAdversaria = equipe.adversario.defesa * mentalidadeAdversaria.modDef;
                    const chanceDeGolNoChute = (ataqueEfetivo / (ataqueEfetivo + defesaEfetivaAdversaria)) * 0.55;
                    if (Math.random() < chanceDeGolNoChute) {
                        equipe.stats.chutesNoGol++;
                        const chanceDeGol = (ataqueEfetivo / (ataqueEfetivo + defesaEfetivaAdversaria)) * 0.7;
                        if (Math.random() < chanceDeGol) {
                            equipe.stats.gols++;
                            jogador.gols++;
                            const assistente = selecionarJogador(partidaJogadores[equipe.id], jogador.nome);
                            if (assistente && Math.random() < 0.7) assistente.assistencias++;
                            const logAssist = assistente ? ` (Assist: ${assistente.nome})` : '';
                            adicionarLog(equipe.logDiv, minuto, '⚽', 'GOL!', `${jogador.nome}${logAssist}`, 'log-gol');
                        } else {
                            adicionarLog(equipe.logDiv, minuto, '🎯', 'Chute a Gol', jogador.nome);
                        }
                    } else {
                        adicionarLog(equipe.logDiv, minuto, '💨', 'Chute pra Fora', jogador.nome);
                    }
                }
                
                const chanceDeFalta = (100 - ((equipe.time.ataque + equipe.time.defesa) / 2)) / 3000;
                if(Math.random() < chanceDeFalta) {
                    const jogador = selecionarJogador(partidaJogadores[equipe.id]);
                    if(jogador && !jogador.cartaoAmarelo && !jogador.cartaoVermelho) {
                        if(Math.random() < 0.1) {
                            jogador.cartaoVermelho = true;
                            equipe.stats.vermelhos++;
                            adicionarLog(equipe.logDiv, minuto, '🟥', 'Cartão Vermelho', jogador.nome);
                        } else {
                            jogador.cartaoAmarelo = true;
                            equipe.stats.amarelos++;
                            adicionarLog(equipe.logDiv, minuto, '🟨', 'Cartão Amarelo', jogador.nome);
                        }
                    }
                }
                
                atualizarStats(stats);

                if (minuto >= 90) {
                    clearInterval(simulacaoIntervalo);
                    placarCentralDiv.innerHTML = `${stats.casa.gols} - ${stats.visitante.gols} <div class="minuto-jogo" style="color: var(--cor-amarelo);">FIM DE JOGO</div>`;
                    btnVerNotas.classList.remove('escondido');
                    btnVerNotas.onclick = () => exibirTelaDeNotas(stats);
                }
            };
            simulacaoIntervalo = setInterval(tickPartida, velocidades[velocidadeAtualIndex].valor);
        }
        function selecionarJogador(listaJogadores, nomeExcluido = null) {
            let candidatos = listaJogadores.filter(j => j.nome !== nomeExcluido && !j.cartaoVermelho);
            if(candidatos.length === 0) return null;
            const listaPonderada = [];
            candidatos.forEach(jogador => {
                const peso = { "ATA": 5, "MEI": 3, "DEF": 2, "GOL": 1 };
                for (let i = 0; i < (peso[jogador.posicao] || 1); i++) listaPonderada.push(jogador);
            });
            return listaPonderada[Math.floor(Math.random() * listaPonderada.length)];
        }
        function atualizarStats(stats) {
            document.getElementById('stat-chutes-casa').textContent = stats.casa.chutes;
            document.getElementById('stat-chutes-visitante').textContent = stats.visitante.chutes;
            document.getElementById('stat-chutes-gol-casa').textContent = stats.casa.chutesNoGol;
            document.getElementById('stat-chutes-gol-visitante').textContent = stats.visitante.chutesNoGol;
            document.getElementById('stat-amarelos-casa').textContent = stats.casa.amarelos;
            document.getElementById('stat-amarelos-visitante').textContent = stats.visitante.amarelos;
            document.getElementById('stat-vermelhos-casa').textContent = stats.casa.vermelhos;
            document.getElementById('stat-vermelhos-visitante').textContent = stats.visitante.vermelhos;
            const totalPosse = stats.casa.posse + stats.visitante.posse;
            const posseCasa = totalPosse > 0 ? Math.round((stats.casa.posse / totalPosse) * 100) : 50;
            document.getElementById('stat-posse-casa').textContent = posseCasa;
            document.getElementById('stat-posse-visitante').textContent = 100 - posseCasa;
        }
        function adicionarLog(logDiv, minuto, icone, tipoEvento, jogador, classeEspecial = '') {
            const p = document.createElement('p');
            p.className = `log-evento ${classeEspecial}`;
            let conteudo = `<span class="minuto">${minuto}'</span> <span class="icone">${icone}</span> <span class="tipo-evento">${tipoEvento}</span> <span class="jogador">${jogador}</span>`;
            if (logDiv.id === 'log-visitante') {
                 conteudo = `<span class="jogador">${jogador}</span> <span class="tipo-evento">${tipoEvento}</span> <span class="icone">${icone}</span> <span class="minuto">${minuto}'</span>`;
            }
            p.innerHTML = conteudo;
            logDiv.appendChild(p);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        function calcularNota(jogador, resultadoTime) {
            let nota = 6.5;
            if (jogador.posicao === 'GOL') nota += 0.2;
            if (jogador.posicao === 'ATA') nota -= 0.3;
            nota += jogador.gols * 1.5;
            nota += jogador.assistencias * 0.8;
            if (jogador.cartaoAmarelo) nota -= 0.5;
            if (jogador.cartaoVermelho) nota -= 2.5;
            if (resultadoTime === 'vitoria') nota += 0.3;
            if (resultadoTime === 'derrota') nota -= 0.3;
            return Math.max(3.0, Math.min(10.0, nota)).toFixed(1);
        }
        function getClasseNota(nota) {
            if (nota >= 8.5) return 'nota-otima';
            if (nota >= 7.5) return 'nota-boa';
            if (nota >= 6.0) return 'nota-media';
            if (nota >= 4.5) return 'nota-ruim';
            return 'nota-pessima';
        }
        function adicionarNotaJogadorDOM(divPai, jogador) {
            const div = document.createElement('div');
            div.className = 'nota-jogador';
            let statsHTML = '';
            if (jogador.gols > 0) statsHTML += `<span>⚽ ${jogador.gols}</span>`;
            if (jogador.assistencias > 0) statsHTML += `<span>👟 ${jogador.assistencias}</span>`;
            div.innerHTML = `<div class="jogador-nome-stats">${jogador.nome}<div class="jogador-stats">${statsHTML}</div></div><div class="nota-valor ${getClasseNota(jogador.nota)}">${jogador.nota}</div>`;
            divPai.appendChild(div);
        }
        function exibirTelaDeNotas(stats) {
            mostrarTela(telaNotas);
            const notasCasaDiv = document.getElementById('notas-casa');
            const notasVisitanteDiv = document.getElementById('notas-visitante');
            notasCasaDiv.innerHTML = `<h3>${partidaJogadores.casa[0].timeNome}</h3>`;
            notasVisitanteDiv.innerHTML = `<h3>${partidaJogadores.visitante[0].timeNome}</h3>`;
            let resultadoCasa, resultadoVisitante;
            if (stats.casa.gols > stats.visitante.gols) { resultadoCasa = 'vitoria'; resultadoVisitante = 'derrota'; }
            else if (stats.casa.gols < stats.visitante.gols) { resultadoCasa = 'derrota'; resultadoVisitante = 'vitoria'; }
            else { resultadoCasa = 'empate'; resultadoVisitante = 'empate'; }
            partidaJogadores.casa.forEach(jogador => {
                jogador.nota = calcularNota(jogador, resultadoCasa);
                adicionarNotaJogadorDOM(notasCasaDiv, jogador);
            });
            partidaJogadores.visitante.forEach(jogador => {
                jogador.nota = calcularNota(jogador, resultadoVisitante);
                adicionarNotaJogadorDOM(notasVisitanteDiv, jogador);
            });
        }
        
        btnExportar.addEventListener('click', () => {
            if(timesDB.length === 0) { alert("Não há times para exportar."); return; }
            const dataStr = JSON.stringify(timesDB, null, 2);
            const blob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wfs_backup_times.json';
            a.click();
            URL.revokeObjectURL(url);
        });
        btnImportar.addEventListener('click', () => importarArquivoInput.click());
        importarArquivoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const novosTimes = JSON.parse(event.target.result);
                    if (!Array.isArray(novosTimes) || (novosTimes.length > 0 && !novosTimes[0].id)) {
                        alert("Arquivo inválido.");
                        return;
                    }
                    if (confirm("Isso substituirá TODOS os seus times atuais. Deseja continuar?")) {
                        timesDB = novosTimes;
                        salvarTimesNoLocalStorage();
                        popularFiltroCategorias(filtroCategoriaEditor);
                        popularListaEditor();
                        alert("Times importados com sucesso!");
                    }
                } catch (error) {
                    alert("Erro ao ler o arquivo.");
                } finally {
                    importarArquivoInput.value = '';
                }
            };
            reader.readAsText(file);
        });

        carregarTimes();
        popularGaleriaEmojis();
        atualizarDisplayVelocidade();
        atualizarDisplayTatica(taticaSliderCasa, displayTaticaCasa);
        atualizarDisplayTatica(taticaSliderVisitante, displayTaticaVisitante);
    });
    </script>
</body>
</html>